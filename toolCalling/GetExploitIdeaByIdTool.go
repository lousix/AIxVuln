package toolCalling

import (
	"AIxVuln/taskManager"
	"encoding/json"
)

type GetExploitIdeaByIdTool struct {
	task *taskManager.Task
}

func NewGetExploitIdeaByIdTool(task *taskManager.Task) *GetExploitIdeaByIdTool {
	return &GetExploitIdeaByIdTool{task: task}
}

func (h *GetExploitIdeaByIdTool) Name() string {
	return "GetExploitIdeaByIdTool"
}
func (h *GetExploitIdeaByIdTool) Description() string {
	return "Retrieve the full details of an ExploitIdea by its ID (e.g. 'E.0'). Returns the complete exploit information including harm, condition, evidence, PoC, etc."
}
func (h *GetExploitIdeaByIdTool) Parameters() map[string]interface{} {
	return map[string]interface{}{
		"type": "object",
		"properties": map[string]interface{}{
			"exploitIdeaId": map[string]interface{}{
				"type":        "string",
				"description": "The exploitIdeaId to look up, e.g. 'E.0'.(required)",
			},
		},
	}
}

func (h *GetExploitIdeaByIdTool) Execute(parameters map[string]interface{}) string {
	idTemp := parameters["exploitIdeaId"]
	if idTemp == nil {
		return Fail("Missing 'exploitIdeaId' parameter")
	}
	id, ok := idTemp.(string)
	if !ok || len(id) < 2 {
		return Fail("Invalid exploitIdeaId")
	}
	getter := h.task.GetExploitIdeaGetter()
	if getter == nil {
		return Fail("ExploitIdea getter not available")
	}
	idea, err := getter(id)
	if err != nil {
		return Fail(err.Error())
	}
	js, _ := json.Marshal(idea)
	return Success(string(js))
}
